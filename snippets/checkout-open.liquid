<!--     #checkout redirect script -->

{% if template != 'cart' %}  

  var loc = window.location.href;

  if (window.location.href.indexOf("?") > -1 )
  {
    if (window.location.href.indexOf("?cartopen=true") > -1) {
      let updatedUlr = window.location.href.replace('?cartopen=true','');
      localStorage.setItem( "PrevLocation", updatedUlr );
      window.location.replace(updatedUlr);
    } 
    else {
      if (window.location.href.indexOf("&cartopen=true") > -1) {
        let updatedUlr = window.location.href.replace('&cartopen=true','');  
        localStorage.setItem( "PrevLocation", updatedUlr );
        window.location.replace(updatedUlr);
      }
      else {
        localStorage.setItem( "PrevLocation", loc);
      }
    }
  }
  else {
    localStorage.setItem( "PrevLocation", loc);
  }


{% endif %}

{% if template == 'cart' %}  

  var lastLoc = localStorage.getItem("PrevLocation");
  var cartopen = "?cartopen=true";

  if(lastLoc.indexOf("?") > -1 ) {
    cartopen = "&cartopen=true";
    console.log("working 1");
  }

  if (lastLoc == "" ) {
    window.location.replace(`https://{{ shop.domain }}{{ routes.root_url }}?cartopen=true`);
    console.log("working 2");
  } 
  else {
    window.location.replace(`${lastLoc}?cartopen=true`);
    console.log("working 3");
  }




{% endif %}